{"version":3,"sources":["../../src/client/WiggleClientEngine.js"],"names":["WiggleClientEngine","gameEngine","options","WiggleRenderer","document","querySelector","addEventListener","updateName","value","classList","add","on","obj","playerId","body","disabled","window","location","reload","mouseX","mouseY","updateMouseXY","bind","sendMouseAngle","e","preventDefault","touches","item","pageX","pageY","newName","player","world","queryObject","friendlyName","clientWidth","zoom","clientHeight","dx","position","y","dy","x","Math","sqrt","sendInput","directionStop","movement","angle","atan2","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine } from 'lance-gg';\nimport WiggleRenderer from '../client/WiggleRenderer';\n\nexport default class WiggleClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n        super(gameEngine, options, WiggleRenderer);\n\n        // enter name\n        document.querySelector('#nameSubmit').addEventListener('click', () => {\n            this.updateName(document.querySelector('#nameField').value);\n            document.querySelector('#name-entry').classList.add('hidden');\n        });\n\n\n        // show try-again button\n        gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId) {\n                document.body.classList.add('lostGame');\n                document.querySelector('#tryAgain').disabled = false;\n            }\n        });\n\n        // restart game\n        document.querySelector('#tryAgain').addEventListener('click', () => {\n            window.location.reload();\n        });\n\n        this.mouseX = null;\n        this.mouseY = null;\n\n        document.addEventListener('mousemove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('mouseenter', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchmove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchenter', this.updateMouseXY.bind(this), false);\n        this.gameEngine.on('client__preStep', this.sendMouseAngle.bind(this));\n    }\n\n    updateMouseXY(e) {\n        e.preventDefault();\n        if (e.touches) e = e.touches.item(0);\n        this.mouseX = e.pageX;\n        this.mouseY = e.pageY;\n    }\n\n    updateName(newName) {\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        player.friendlyName = newName;\n    }\n\n    sendMouseAngle() {\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        if (this.mouseY === null || player === null) return;\n\n        let mouseX = (this.mouseX - document.body.clientWidth/2) / this.zoom;\n        let mouseY = (this.mouseY - document.body.clientHeight/2) / this.zoom;\n        let dx = mouseY - player.position.y;\n        let dy = mouseX - player.position.x;\n        if (Math.sqrt(dx * dx + dy * dy) < 0.5) {\n            this.sendInput(this.gameEngine.directionStop, { movement: true });\n            return;\n        }\n\n        let angle = Math.atan2(dx, dy);\n        this.sendInput(angle, { movement: true });\n    }\n}\n"],"file":"WiggleClientEngine.js"}