{"version":3,"sources":["../../src/client/WiggleRenderer.js"],"names":["ctx","canvas","game","c","WiggleRenderer","gameEngine","clientEngine","document","createElement","width","window","innerWidth","height","innerHeight","body","insertBefore","getElementById","w","h","zoom","spaceHeight","spaceWidth","getContext","lineWidth","strokeStyle","fillStyle","t","dt","clearRect","save","translate","scale","world","forEachObject","id","obj","Wiggle","drawWiggle","Food","drawFood","restore","zeroTo240","Math","floor","cos","isPlayer","playerId","x","position","y","rainbowColors","drawCircle","headRadius","i","bodyParts","length","nextPos","bodyRadius","angle","direction","directionStop","PI","eye1","TwoVector","eyeAngle","sin","eye2","multiplyScalar","eyeDist","add","eyeRadius","innerHTML","friendlyName","f","foodRadius","radius","fill","beginPath","arc","stroke","closePath","moveTo","lineTo","Renderer"],"mappings":"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","sourcesContent":["import { Renderer, TwoVector } from 'lance-gg';\nimport Wiggle from '../common/Wiggle';\nimport Food from '../common/Food';\n\nlet ctx = null;\nlet canvas = null;\nlet game = null;\nlet c = 0;\n\nexport default class WiggleRenderer extends Renderer {\n\n    constructor(gameEngine, clientEngine) {\n        super(gameEngine, clientEngine);\n        game = gameEngine;\n        canvas = document.createElement('canvas');\n        canvas.width = window.innerWidth;\n        canvas.height = window.innerHeight;\n        document.body.insertBefore(canvas, document.getElementById('logo'));\n        game.w = canvas.width;\n        game.h = canvas.height;\n        clientEngine.zoom = game.h / game.spaceHeight;\n        if (game.w / game.spaceWidth < clientEngine.zoom) clientEngine.zoom = game.w / game.spaceWidth;\n        ctx = canvas.getContext('2d');\n        ctx.lineWidth = 2 / clientEngine.zoom;\n        ctx.strokeStyle = ctx.fillStyle = 'white';\n    }\n\n    draw(t, dt) {\n        super.draw(t, dt);\n\n        // Clear the canvas\n        ctx.clearRect(0, 0, game.w, game.h);\n\n        // Transform the canvas\n        // Note that we need to flip the y axis since Canvas pixel coordinates\n        // goes from top to bottom, while physics does the opposite.\n        ctx.save();\n        ctx.translate(game.w/2, game.h/2); // Translate to the center\n        ctx.scale(this.clientEngine.zoom, this.clientEngine.zoom);  // Zoom in and flip y axis\n\n        // Draw all things\n        game.world.forEachObject((id, obj) => {\n            if (obj instanceof Wiggle) this.drawWiggle(obj);\n            else if (obj instanceof Food) this.drawFood(obj);\n        });\n\n        ctx.restore();\n\n    }\n\n    rainbowColors() {\n        c += 0.005;\n        let zeroTo240 = Math.floor((Math.cos(c) + 1) * 120);\n        return `rgb(${zeroTo240},100,200)`;\n    }\n\n    drawWiggle(w) {\n\n        // draw head and body\n        let isPlayer = w.playerId === this.gameEngine.playerId;\n        let x = w.position.x;\n        let y = w.position.y;\n        if (isPlayer) ctx.fillStyle = this.rainbowColors();\n        this.drawCircle(x, y, game.headRadius, true);\n        for (let i = 0; i < w.bodyParts.length; i++) {\n            let nextPos = w.bodyParts[i];\n            if (isPlayer) ctx.fillStyle = this.rainbowColors();\n            this.drawCircle(nextPos.x, nextPos.y, game.bodyRadius, true);\n        }\n\n        // draw eyes\n        let angle = +w.direction;\n        if (w.direction === game.directionStop) {\n            angle = - Math.PI / 2;\n        }\n        let eye1 = new TwoVector(Math.cos(angle + game.eyeAngle), Math.sin(angle + game.eyeAngle));\n        let eye2 = new TwoVector(Math.cos(angle - game.eyeAngle), Math.sin(angle - game.eyeAngle));\n        eye1.multiplyScalar(game.eyeDist).add(w.position);\n        eye2.multiplyScalar(game.eyeDist).add(w.position);\n        ctx.fillStyle = 'black';\n        this.drawCircle(eye1.x, eye1.y, game.eyeRadius, true);\n        this.drawCircle(eye2.x, eye2.y, game.eyeRadius, true);\n        ctx.fillStyle = 'white';\n\n        // update status\n        if (isPlayer) {\n            document.getElementById('wiggle-length').innerHTML = '<strong>Wiggle Length</strong>: ' + w.bodyParts.length;\n            document.getElementById('player-name').innerHTML = '<strong>Player Name</strong>: ' + w.friendlyName;\n        }\n    }\n\n    drawFood(f) {\n        ctx.strokeStyle = ctx.fillStyle = 'Orange';\n        this.drawCircle(f.position.x, f.position.y, game.foodRadius, true);\n        ctx.strokeStyle = ctx.fillStyle = 'White';\n    }\n\n    drawCircle(x, y, radius, fill) {\n        ctx.beginPath();\n        ctx.arc(x, y, radius, 0, 2*Math.PI);\n        fill?ctx.fill():ctx.stroke();\n        ctx.closePath();\n    }\n\n    drawBounds() {\n        ctx.beginPath();\n        ctx.moveTo(-game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.lineTo(-game.spaceWidth/2, game.spaceHeight/2);\n        ctx.lineTo( game.spaceWidth/2, game.spaceHeight/2);\n        ctx.lineTo( game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.lineTo(-game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.closePath();\n        ctx.stroke();\n    }\n\n}\n"],"file":"WiggleRenderer.js"}